<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‘‘ ê±°ê¾¸ë¡œ ë°›ì•„ì“°ê¸° (ë²”ìœ„ ì„ íƒ)</title>
    <style>
        /* 1. ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap');

        :root {
            --font-main: 'Gowun Dodum', sans-serif;
            --color-bg: #f7f3e9;
            --color-surface: #fff;
            --color-primary: #5cb85c;
            /* green */
            --color-secondary: #0275d8;
            /* blue */
            --color-warning: #f0ad4e;
            /* orange */
            --color-text: #333;
            --color-border: #ddd;
            --color-disabled: #f9f9f9;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--color-bg);
            color: var(--color-text);
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        main {
            background-color: var(--color-surface);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 700px;
            margin: 20px auto;
            padding: 30px 40px;
            box-sizing: border-box;
        }

        /* [ìˆ˜ì •] ì œëª©ì´ .header-with-linkì— ì˜í•´ ì¤‘ì•™ ì •ë ¬ë˜ë¯€ë¡œ text-align: center ì œê±° */
        h1 {
            color: var(--color-primary);
            /* text-align: center; */
            margin-top: 0;
            /* margin-bottom: 20px; */
            /* ê°„ê²©ì€ ë¶€ëª¨(.header-with-link)ì—ì„œ ê´€ë¦¬ */
            margin-bottom: 0;
        }

        /* 7. ì œëª© ë° ì•„ì´ì½˜ ë§í¬ ìŠ¤íƒ€ì¼ (ìƒˆë¡œ ì¶”ê°€) */
        .header-with-link {
            display: flex;
            /* ìì‹ ìš”ì†Œë¥¼ ê°€ë¡œë¡œ ì •ë ¬ */
            justify-content: center;
            /* h1ì„ ì¤‘ì•™ì— ë°°ì¹˜ */
            align-items: center;
            position: relative;
            /* ì•„ì´ì½˜ ìœ„ì¹˜ ì§€ì •ì„ ìœ„í•œ ê¸°ì¤€ì  */
            margin-bottom: 20px;
            /* ê¸°ì¡´ h1ì˜ í•˜ë‹¨ ê°„ê²© ë³µì› */
        }

        .icon-link {
            position: absolute;
            /* .header-with-link ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ ì§€ì • */
            right: 0;
            /* ìš°ì¸¡ ëì— ë°°ì¹˜ */
            top: 50%;
            transform: translateY(-50%);
            /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
            font-size: 1.8em;
            /* ì•„ì´ì½˜ í¬ê¸° */
            text-decoration: none;
            /* ë°‘ì¤„ ì œê±° */
            color: var(--color-warning);
            /* ì•„ì´ì½˜ ìƒ‰ìƒ (ê²½ê³ ìƒ‰ ì‚¬ìš©) */
            transition: color 0.2s;
            line-height: 1;
            /* ë†’ì´ ì¡°ì • */
        }

        .icon-link:hover {
            color: #e89e3a;
            /* í˜¸ë²„ ìƒ‰ìƒ */
        }

        /* [ìˆ˜ì • ë] */


        /* 2. selection-group: í•„í„° ê·¸ë£¹ ë˜í¼ */
        .selection-group {
            margin-bottom: 30px;
            text-align: left;
            padding: 20px;
            border: 1px solid var(--color-border);
            border-radius: 10px;
            background-color: #fafafa;
        }

        .selection-group>label {
            display: block;
            font-size: 1.3em;
            font-weight: bold;
            color: var(--color-text);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--color-primary);
        }

        /* 3. ë¼ë””ì˜¤ ë²„íŠ¼ ê·¸ë£¹ (ê¸°ë³¸ ìœ í˜•) */
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            justify-content: flex-start;
        }

        .radio-group label {
            font-weight: normal;
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 1.15em;
        }

        .radio-group input {
            width: 18px;
            height: 18px;
            margin-right: 8px;
        }

        /* 4. ë²„íŠ¼/íƒœê·¸í˜• ë¼ë””ì˜¤ ë²„íŠ¼ UI */
        .button-grid-group,
        .radio-list-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        /* ì‹¤ì œ ë¼ë””ì˜¤ ë²„íŠ¼ì€ ìˆ¨ê¹€ */
        .button-grid-group input[type="radio"],
        .radio-list-group input[type="radio"] {
            display: none;
        }

        /* ë²„íŠ¼/íƒœê·¸ì²˜ëŸ¼ ë³´ì¼ ë¼ë²¨ ìŠ¤íƒ€ì¼ */
        .button-grid-group label span,
        .radio-list-group label span {
            display: block;
            padding: 10px 15px;
            font-size: 1.1em;
            font-family: var(--font-main);
            border: 2px solid var(--color-border);
            border-radius: 8px;
            cursor: pointer;
            background-color: #fff;
            color: var(--color-text);
            transition: all 0.2s ease;
            line-height: 1.4;
        }

        .radio-list-group label {
            width: 100%;
            /* ëª©ë¡í˜•ì€ 100% ë„ˆë¹„ */
        }

        .button-grid-group label span:hover,
        .radio-list-group label span:hover {
            border-color: var(--color-secondary);
            background-color: #f7fcff;
        }

        /* 'ì „ì²´' ë²„íŠ¼ íŠ¹ë³„ ìŠ¤íƒ€ì¼ */
        .button-grid-group label[data-value="all"] span,
        .radio-list-group label[data-value="all"] span {
            color: var(--color-secondary);
            font-weight: bold;
            border-style: dashed;
        }

        /* â˜… ì„ íƒëœ í•­ëª©ì˜ ìŠ¤íƒ€ì¼ â˜… */
        .button-grid-group input[type="radio"]:checked+span,
        .radio-list-group input[type="radio"]:checked+span {
            background-color: var(--color-secondary);
            color: white;
            border-color: var(--color-secondary);
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(2, 117, 216, 0.2);
        }

        /* 5. 'ë‹¨ì›' ì˜ì—­ (ë™ì  í‘œì‹œ) */
        #unit-selection-area.disabled {
            background-color: var(--color-disabled);
            opacity: 0.7;
            pointer-events: none;
        }

        #unit-selection-area.disabled>label {
            color: #999;
            border-bottom-color: var(--color-border);
        }

        /* 6. ì‹œì‘ ë²„íŠ¼ */
        #start-quiz-btn {
            display: block;
            width: 100%;
            padding: 18px;
            font-size: 1.4em;
            font-family: var(--font-main);
            font-weight: bold;
            color: #fff;
            background-color: var(--color-warning);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 30px;
            transition: background-color 0.3s;
        }

        #start-quiz-btn:hover {
            background-color: #e89e3a;
        }
    </style>
</head>

<body>
    <main>
        <div class="header-with-link">
            <h1>âœï¸ í€´ì¦ˆ ë²”ìœ„ ì„ íƒ</h1>
            <div style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); display: flex; gap: 10px;">
                <a href="toc.html" class="icon-link" style="position: static; transform: none;" aria-label="ëª©ì°¨ ë³´ê¸°">
                    ğŸ“‘
                </a>
                <a href="rules.html" class="icon-link" style="position: static; transform: none;"
                    aria-label="ê·œì¹™ ì„¤ëª… í˜ì´ì§€ë¡œ ì´ë™">
                    ğŸ“š
                </a>
            </div>
        </div>
        <div class="selection-group">
            <label>í€´ì¦ˆ ìœ í˜• ì„ íƒ</label>
            <div class="radio-group">
                <label>
                    <input type="radio" name="quiz-type" value="word" checked> ë‚±ë§ í€´ì¦ˆ
                </label>
                <label>
                    <input type="radio" name="quiz-type" value="sentence"> ë¬¸ì¥ í€´ì¦ˆ
                </label>
            </div>
        </div>

        <div class="selection-group" id="grade-select-area">
            <label for="grade-select">í•™ë…„/í•™ê¸° ì„ íƒ</label>
            <div class="button-grid-group" id="grade-select-container">
                <label data-value="all">
                    <input type="radio" name="grade" value="all" checked>
                    <span>ì „ì²´ í•™ë…„/í•™ê¸°</span>
                </label>
            </div>
        </div>

        <div class="selection-group disabled" id="unit-selection-area">
            <label for="rule-select">ë‹¨ì› ì„ íƒ (í•™ë…„/í•™ê¸° ì„ íƒ í•„ìš”)</label>
            <div class="radio-list-group" id="unit-select-container">
                <label data-value="all">
                    <input type="radio" name="unit" value="all" checked>
                    <span>- ì „ì²´ ë‹¨ì› -</span>
                </label>
            </div>
        </div>

        <div class="selection-group" id="rule-select-area">
            <label for="rule-select">ê·œì¹™ ì„ íƒ</label>
            <div class="radio-list-group" id="rule-select-container">
                <label data-value="all">
                    <input type="radio" name="rule" value="all" checked>
                    <span>- ì „ì²´ ê·œì¹™ -</span>
                </label>
            </div>
        </div>

        <button id="start-quiz-btn">ğŸš€ í€´ì¦ˆ ì‹œì‘!</button>
    </main>

    <script src="database.js"></script>

    <script>
        // --- 1. DOM ìš”ì†Œ ìºì‹± ---
        const gradeContainer = document.getElementById('grade-select-container');
        const unitArea = document.getElementById('unit-selection-area');
        const unitContainer = document.getElementById('unit-select-container');
        const ruleContainer = document.getElementById('rule-select-container');
        const startQuizBtn = document.getElementById('start-quiz-btn');

        // --- 2. í—¬í¼ í•¨ìˆ˜: ë¼ë””ì˜¤ ë²„íŠ¼ ìƒì„± ---
        /**
         * ì§€ì •ëœ ì»¨í…Œì´ë„ˆì— ë¼ë””ì˜¤ ë²„íŠ¼ ëª©ë¡ì„ ìƒì„±í•©ë‹ˆë‹¤.
         * @param {HTMLElement} container - ë¼ë””ì˜¤ ë²„íŠ¼ì´ ì¶”ê°€ë  ë¶€ëª¨ ìš”ì†Œ
         * @param {string} name - ë¼ë””ì˜¤ ê·¸ë£¹ì˜ 'name' ì†ì„±
         * @param {string[]} optionsArray - ì˜µì…˜ ê°’ì˜ ë°°ì—´
         * @param {string} defaultCheckedValue - ê¸°ë³¸ìœ¼ë¡œ ì²´í¬ë  ê°’
         */
        function populateRadioGroup(container, name, optionsArray, defaultCheckedValue = "all") {
            // "ì „ì²´" ì˜µì…˜ì€ ì´ë¯¸ HTMLì— ìˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ë¹„ì›ë‹ˆë‹¤.
            container.innerHTML = '';

            // "ì „ì²´" ì˜µì…˜ ë™ì  ì¶”ê°€
            const allLabel = document.createElement('label');
            allLabel.dataset.value = "all";
            allLabel.innerHTML = `
                <input type="radio" name="${name}" value="all" ${defaultCheckedValue === 'all' ? 'checked' : ''}>
                <span>- ì „ì²´ ${name === 'grade' ? 'í•™ë…„/í•™ê¸°' : (name === 'unit' ? 'ë‹¨ì›' : 'ê·œì¹™')} -</span>
            `;
            container.appendChild(allLabel);

            // ë‚˜ë¨¸ì§€ ì˜µì…˜ ì¶”ê°€
            optionsArray.forEach(optionText => {
                if (!optionText) return; // ë¹ˆ ê°’ ê±´ë„ˆë›°ê¸°

                const label = document.createElement('label');
                label.dataset.value = optionText;
                label.innerHTML = `
                    <input type="radio" name="${name}" value="${optionText}" ${defaultCheckedValue === optionText ? 'checked' : ''}>
                    <span>${optionText}</span>
                `;
                container.appendChild(label);
            });
        }

        // --- 3. (í•µì‹¬) ë°ì´í„° ì¶”ì¶œ ë° ì •ì œ ---
        try {
            if (typeof quizData === 'undefined') {
                throw new Error("database.jsë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
            }

            // 3-1. í•™ë…„/í•™ê¸° ëª©ë¡ ì¶”ì¶œ (ì¤‘ë³µ ì œê±° ë° ì •ë ¬)
            const gradeSet = new Set(quizData.map(item => item["Year/Semester"]));
            const allGrades = [...gradeSet].sort();

            // 3-2. ê·œì¹™ ëª©ë¡ ì¶”ì¶œ (v5 ë°ì´í„°ë² ì´ìŠ¤ ëŒ€ì‘)
            const ruleSet = new Set();
            quizData.forEach(item => {
                // 'ë‹¨ì–´'ì™€ 'ë¬¸ì¥'ì˜ 'ì ìš©ê·œì¹™ 1~5' ì—´ì„ ëª¨ë‘ í™•ì¸í•©ë‹ˆë‹¤.
                for (let i = 1; i <= 5; i++) {
                    // ë°ì´í„°ë² ì´ìŠ¤ í‚¤: "Syllable 1 Rule", "Syllable 2 rule" (ëŒ€ì†Œë¬¸ì í˜¼ìš© ì£¼ì˜)
                    const keysToCheck = [`Syllable ${i} Rule`, `Syllable ${i} rule`];
                    keysToCheck.forEach(key => {
                        if (item[key]) ruleSet.add(item[key]);
                    });
                }
            });
            const allRules = [...ruleSet].sort(); // (ì˜ˆ: ["1ë²ˆì´ì‚¬ ê°€ëŠ” ë°›ì¹¨", "2ë²ˆë°›ì¹¨ ëŒ€ì¥"])

            // --- 4. ì´ˆê¸° í™”ë©´ êµ¬ì„± ---
            populateRadioGroup(gradeContainer, 'grade', allGrades);
            populateRadioGroup(ruleContainer, 'rule', allRules);

            // --- 5. (í•µì‹¬) 'í•™ë…„' -> 'ë‹¨ì›' ì—°ë™ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
            gradeContainer.addEventListener('change', (event) => {
                const selectedGrade = event.target.value;

                if (selectedGrade === 'all') {
                    // 'ì „ì²´' ì„ íƒ ì‹œ 'ë‹¨ì›' ì˜ì—­ ë¹„í™œì„±í™” ë° ì´ˆê¸°í™”
                    unitArea.classList.add('disabled');
                    populateRadioGroup(unitContainer, 'unit', []); // 'ì „ì²´ ë‹¨ì›'ë§Œ ë‚¨ê¹€
                } else {
                    // íŠ¹ì • í•™ë…„ ì„ íƒ ì‹œ 'ë‹¨ì›' ëª©ë¡ ë™ì  ìƒì„±
                    unitArea.classList.remove('disabled');

                    // ì„ íƒëœ í•™ë…„ì˜ ë‹¨ì› ëª©ë¡ë§Œ ì¶”ì¶œ
                    const unitSet = new Set(
                        quizData
                            .filter(item => item["Year/Semester"] === selectedGrade)
                            .map(item => item["Chapter"])
                    );
                    const allUnits = [...unitSet].sort();

                    populateRadioGroup(unitContainer, 'unit', allUnits);
                }
            });

            // --- 6. 'í€´ì¦ˆ ì‹œì‘' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ---
            startQuizBtn.addEventListener('click', () => {
                // ê° ê·¸ë£¹ì—ì„œ ì„ íƒëœ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
                const selectedGrade = document.querySelector('input[name="grade"]:checked').value;
                const selectedUnit = document.querySelector('input[name="unit"]:checked').value;
                const selectedRule = document.querySelector('input[name="rule"]:checked').value;
                const selectedType = document.querySelector('input[name="quiz-type"]:checked').value;

                // URL íŒŒë¼ë¯¸í„°ë¡œ ì¸ì½”ë”©í•˜ì—¬ quiz.htmlë¡œ ì „ë‹¬
                const params = new URLSearchParams({
                    grade: selectedGrade,
                    unit: selectedUnit,
                    rule: selectedRule,
                    type: selectedType
                });

                window.location.href = `quiz.html?${params.toString()}`;
            });

        } catch (error) {
            console.error("í€´ì¦ˆ ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            document.querySelector('main').innerHTML = `<h1>ì˜¤ë¥˜ ë°œìƒ</h1><p>database.js íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ê±°ë‚˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p><p>${error.message}</p>`;
        }
    </script>
</body>

</html>