<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‘‘ ê±°ê¾¸ë¡œ ë°›ì•„ì“°ê¸° (ë²”ìœ„ ì„¤ì •)</title>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-main: 'Gowun Dodum', sans-serif;
            --color-bg: #f7f3e9;
            --color-surface: #fff;
            --color-primary: #5cb85c;
            --color-secondary: #0275d8;
            --color-warning: #f0ad4e;
            --color-text: #333;
            --color-border: #ddd;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--color-bg);
            color: var(--color-text);
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            min-height: 100vh;
        }

        main {
            background-color: var(--color-surface);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
            padding: 30px;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .header-area {
            position: relative;
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--color-primary);
            margin: 0;
            font-size: 1.8em;
        }

        .top-links {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 15px;
        }

        .icon-link {
            text-decoration: none;
            font-size: 1.5em;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .icon-link:hover {
            transform: scale(1.2);
        }

        /* ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .section {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid var(--color-border);
            border-radius: 10px;
            background-color: #fafafa;
        }

        .section h2 {
            font-size: 1.2em;
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--color-primary);
            padding-bottom: 10px;
            color: #555;
        }

        /* ë¼ë””ì˜¤ ë²„íŠ¼ ë””ìì¸ */
        .options-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center; /* ì…ë ¥ì°½ ë†’ì´ ì •ë ¬ */
        }

        .radio-label {
            display: inline-block;
            cursor: pointer;
        }

        .radio-label input {
            display: none; /* ì‹¤ì œ ë¼ë””ì˜¤ ë²„íŠ¼ ìˆ¨ê¹€ */
        }

        .radio-label span {
            display: block;
            padding: 10px 15px;
            background-color: #fff;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.2s;
        }

        /* ì²´í¬ë˜ì—ˆì„ ë•Œ ìŠ¤íƒ€ì¼ */
        .radio-label input:checked + span {
            background-color: var(--color-secondary);
            color: white;
            border-color: var(--color-secondary);
            font-weight: bold;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }

        /* 'ì „ì²´' ë²„íŠ¼ íŠ¹ë³„ ìŠ¤íƒ€ì¼ */
        .radio-label input[value="all"] + span {
            border-style: dashed;
            color: var(--color-secondary);
        }
        .radio-label input[value="all"]:checked + span {
            color: white;
            border-style: solid;
        }

        /* ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ (í€´ì¦ˆ ê°œìˆ˜) */
        .custom-input {
            width: 60px;
            padding: 8px;
            font-size: 1em;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            text-align: center;
            font-family: var(--font-main);
        }
        .custom-input:disabled {
            background-color: #eee;
            cursor: not-allowed;
        }

        /* ë¹„í™œì„±í™” ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .disabled-section {
            opacity: 0.5;
            pointer-events: none;
            background-color: #eee;
        }

        /* ì‹œì‘ ë²„íŠ¼ */
        #start-btn {
            width: 100%;
            padding: 15px;
            background-color: var(--color-warning);
            color: white;
            font-size: 1.3em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            font-family: var(--font-main);
        }
        #start-btn:hover {
            background-color: #e69528;
        }
        
        /* ì˜¤ë¥˜ ë©”ì‹œì§€ ë°•ìŠ¤ */
        #error-box {
            display: none;
            background-color: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
            border: 1px solid #ef9a9a;
        }
    </style>
</head>

<body>
    <main>
        <div id="error-box"></div>

        <div class="header-area">
            <h1>âœï¸ í€´ì¦ˆ ì„¤ì •</h1>
            <div class="top-links">
                <a href="toc.html" class="icon-link" title="ëª©ì°¨ ë³´ê¸°">ğŸ“‘</a>
                <a href="rules.html" class="icon-link" title="ê·œì¹™ ë³´ê¸°">ğŸ“š</a>
            </div>
        </div>

        <div class="section">
            <h2>1. í€´ì¦ˆ ìœ í˜•</h2>
            <div class="options-container">
                <label class="radio-label">
                    <input type="radio" name="quizType" value="word" checked>
                    <span>ë‚±ë§ í€´ì¦ˆ</span>
                </label>
                <label class="radio-label">
                    <input type="radio" name="quizType" value="sentence">
                    <span>ë¬¸ì¥ í€´ì¦ˆ</span>
                </label>
            </div>
        </div>

        <div class="section">
            <h2>2. í•™ë…„ / í•™ê¸°</h2>
            <div class="options-container" id="grade-options">
                <label class="radio-label">
                    <input type="radio" name="grade" value="all" checked>
                    <span>ë¡œë”© ì¤‘...</span>
                </label>
            </div>
        </div>

        <div class="section disabled-section" id="unit-section">
            <h2>3. ë‹¨ì› ì„ íƒ</h2>
            <div class="options-container" id="unit-options">
                <label class="radio-label">
                    <input type="radio" name="unit" value="all" checked>
                    <span>- ì „ì²´ ë‹¨ì› -</span>
                </label>
            </div>
        </div>

        <div class="section">
            <h2>4. ê·œì¹™ ì„ íƒ (ì„ íƒ ì‚¬í•­)</h2>
            <div class="options-container" id="rule-options">
                </div>
        </div>

        <div class="section">
            <h2>5. í€´ì¦ˆ ìƒì„± ê°œìˆ˜</h2>
            <div class="options-container">
                <label class="radio-label">
                    <input type="radio" name="qCountType" value="5" checked>
                    <span>5ê°œ</span>
                </label>
                <label class="radio-label">
                    <input type="radio" name="qCountType" value="10">
                    <span>10ê°œ</span>
                </label>
                <label class="radio-label">
                    <input type="radio" name="qCountType" value="custom">
                    <span>ì§ì ‘ ì…ë ¥</span>
                </label>
                <input type="number" id="custom-count-input" class="custom-input" min="1" max="50" value="20" disabled>
            </div>
        </div>

        <button id="start-btn">ğŸš€ í€´ì¦ˆ ì‹œì‘í•˜ê¸°</button>
    </main>

    <script src="database.js"></script>

    <script>
        // --- 1. ì•ˆì „ ì¥ì¹˜: ë°ì´í„° ë¡œë“œ í™•ì¸ ---
        const errorBox = document.getElementById('error-box');

        function showError(msg) {
            errorBox.style.display = 'block';
            errorBox.innerHTML = `âš ï¸ ì˜¤ë¥˜ ë°œìƒ: ${msg}`;
            console.error(msg);
        }

        window.addEventListener('DOMContentLoaded', () => {
            // database.js ì—°ê²° í™•ì¸
            if (typeof quizData === 'undefined') {
                showError("ë°ì´í„° íŒŒì¼(database.js)ì´ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>database.js íŒŒì¼ ë§¨ ì•ì— 'const quizData =' ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
                return;
            }
            initApp();
        });

        // --- 2. ì•± ì´ˆê¸°í™” ë¡œì§ ---
        function initApp() {
            const gradeContainer = document.getElementById('grade-options');
            const unitContainer = document.getElementById('unit-options');
            const ruleContainer = document.getElementById('rule-options');
            const unitSection = document.getElementById('unit-section');
            
            // ë¬¸ì œ ê°œìˆ˜ ê´€ë ¨ ìš”ì†Œ
            const countRadios = document.querySelectorAll('input[name="qCountType"]');
            const customInput = document.getElementById('custom-count-input');

            // --- ë°ì´í„° ì¶”ì¶œ ë° ì •ì œ (í•µì‹¬ ìˆ˜ì •) ---
            const grades = new Set();
            const rules = new Set();

            quizData.forEach(item => {
                // 1) í•™ë…„ ìˆ˜ì§‘
                if (item["Year/Semester"]) {
                    grades.add(item["Year/Semester"].trim());
                }

                // 2) ê·œì¹™ ìˆ˜ì§‘ (ì¤‘ë³µ ì œê±° ë¡œì§ ê°•í™”: .trim() í•„ìˆ˜)
                for (let i = 1; i <= 5; i++) {
                    // í‚¤ ì´ë¦„ ëŒ€ì†Œë¬¸ì ë°©ì–´ ì½”ë“œ
                    let ruleVal = item[`Syllable ${i} Rule`] || item[`Syllable ${i} rule`];
                    
                    // ê°’ì´ ìˆê³  ë¬¸ìì—´ì´ë¼ë©´ ê³µë°± ì œê±° í›„ ìˆ˜ì§‘
                    if (ruleVal && typeof ruleVal === 'string' && ruleVal.trim() !== "") {
                        rules.add(ruleVal.trim()); 
                    }
                }
            });

            const sortedGrades = [...grades].sort();
            const sortedRules = [...rules].sort();

            // --- ë Œë”ë§ í•¨ìˆ˜ ---
            function renderRadioButtons(container, name, list, includeAll = true, allText = "ì „ì²´") {
                container.innerHTML = ''; // ì´ˆê¸°í™”

                if (includeAll) {
                    const allHtml = `
                        <label class="radio-label">
                            <input type="radio" name="${name}" value="all" checked>
                            <span>${allText}</span>
                        </label>
                    `;
                    container.insertAdjacentHTML('beforeend', allHtml);
                }

                list.forEach(val => {
                    const html = `
                        <label class="radio-label">
                            <input type="radio" name="${name}" value="${val}">
                            <span>${val}</span>
                        </label>
                    `;
                    container.insertAdjacentHTML('beforeend', html);
                });
            }

            // ì´ˆê¸° ë Œë”ë§ (í•™ë…„, ê·œì¹™)
            renderRadioButtons(gradeContainer, 'grade', sortedGrades, true, "ì „ì²´ í•™ë…„/í•™ê¸°");
            renderRadioButtons(ruleContainer, 'rule', sortedRules, true, "- ì „ì²´ ê·œì¹™ -");


            // --- ì´ë²¤íŠ¸: í•™ë…„ ì„ íƒ ì‹œ ë‹¨ì› ëª©ë¡ ì—…ë°ì´íŠ¸ (ì˜¤ë¥˜ ìˆ˜ì •ë¨) ---
            gradeContainer.addEventListener('change', (e) => {
                if (e.target.name !== 'grade') return;

                const selectedGrade = e.target.value;

                if (selectedGrade === 'all') {
                    unitSection.classList.add('disabled-section');
                    renderRadioButtons(unitContainer, 'unit', [], true, "- ì „ì²´ ë‹¨ì› -");
                } else {
                    unitSection.classList.remove('disabled-section');
                    
                    // í•´ë‹¹ í•™ë…„ì˜ ë‹¨ì›ë§Œ ì¶”ì¶œ (ì¤‘ë³µ ì œê±°)
                    const units = new Set();
                    quizData.forEach(item => {
                        // ë°ì´í„°ì˜ í•™ë…„ê³¼ ì„ íƒí•œ í•™ë…„ì´ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ”ì§€ ë¹„êµ
                        if (item["Year/Semester"] && item["Year/Semester"].trim() === selectedGrade && item["Chapter"]) {
                            units.add(item["Chapter"].trim());
                        }
                    });
                    
                    const sortedUnits = [...units].sort();
                    renderRadioButtons(unitContainer, 'unit', sortedUnits, true, "- ì „ì²´ ë‹¨ì› -");
                }
            });


            // --- ì´ë²¤íŠ¸: ë¬¸ì œ ê°œìˆ˜ (ì§ì ‘ ì…ë ¥ í™œì„±í™”/ë¹„í™œì„±í™”) ---
            countRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    if (e.target.value === 'custom') {
                        customInput.disabled = false;
                        customInput.focus();
                    } else {
                        customInput.disabled = true;
                    }
                });
            });


            // --- ì´ë²¤íŠ¸: ì‹œì‘ ë²„íŠ¼ ---
            document.getElementById('start-btn').addEventListener('click', () => {
                const type = document.querySelector('input[name="quizType"]:checked')?.value || 'word';
                const grade = document.querySelector('input[name="grade"]:checked')?.value || 'all';
                const unit = document.querySelector('input[name="unit"]:checked')?.value || 'all';
                const rule = document.querySelector('input[name="rule"]:checked')?.value || 'all';
                
                // ë¬¸ì œ ê°œìˆ˜ ê³„ì‚°
                let countVal = document.querySelector('input[name="qCountType"]:checked').value;
                if (countVal === 'custom') {
                    countVal = customInput.value;
                    if (!countVal || countVal < 1) countVal = 10; // ë°©ì–´ ì½”ë“œ
                }

                // URL íŒŒë¼ë¯¸í„° ì „ë‹¬ (count ì¶”ê°€)
                const params = new URLSearchParams({ 
                    type, grade, unit, rule, count: countVal 
                });
                
                window.location.href = `quiz.html?${params.toString()}`;
            });
        }
    </script>
</body>

</html>