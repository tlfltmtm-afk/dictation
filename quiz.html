<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ë˜ë°›ì“° _ í€´ì¦ˆ ì„¤ì •</title>
    <link rel="icon" type="image/png" href="favicon-32x32.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonts-archive/Paperlogy/subsets/Paperlogy-dynamic-subset.css" type="text/css"/>
    <meta name="theme-color" content="#FFD700">
    <style>
        body {
            font-family: "Paperlogy", sans-serif;
            background-color: #FFFBEB; /* amber-50 */
            padding-top: 70px;
            padding-bottom: 40px;
            color: #4B5563;
        }

        /* ìƒë‹¨ë°” ìŠ¤íƒ€ì¼ */
        .header-fixed {
            position: fixed; top: 0; left: 0; right: 0; z-index: 50;
            background-color: #FFD700; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            height: 56px;
        }
        
        .nav-link {
            display: flex; align-items: center; justify-content: center;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            color: #1F2937;
            text-decoration: none;
            transition: background-color 0.2s;
        }
        
        .nav-link:hover, .nav-link.active {
            background-color: #FBBF24; /* amber-400 */
        }
        
        /* íˆ´íŒ */
        .tooltip-container { position: relative; }
        .tooltip-container::after {
            content: attr(data-tooltip);
            position: absolute; bottom: -40px; left: 50%; transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8); color: white;
            padding: 6px 12px; border-radius: 6px; font-size: 0.8rem; white-space: nowrap;
            opacity: 0; visibility: hidden; transition: opacity 0.2s; pointer-events: none;
        }
        .tooltip-container:hover::after { opacity: 1; visibility: visible; }

        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” (ì˜µì…˜) */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #FFFBEB; }
        ::-webkit-scrollbar-thumb { background: #FCD34D; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #F59E0B; }
    </style>
</head>

<body class="antialiased">

    <header class="header-fixed flex items-center justify-center px-4">
        <nav class="flex items-center space-x-3">
            <a href="index.html" class="nav-link tooltip-container" aria-label="í™ˆ" data-tooltip="í™ˆìœ¼ë¡œ ì´ë™">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
            </a>
            <a href="test.html" class="nav-link" aria-label="ê¸‰ìˆ˜">ê¸‰ìˆ˜</a>
            <a href="list.html" class="nav-link" aria-label="ëª©ì°¨">ëª©ì°¨</a>
            <a href="quiz.html" class="nav-link active" aria-label="í€´ì¦ˆ">í€´ì¦ˆ</a>
            <a href="rules.html" class="nav-link" aria-label="ë¹„ë²•">ë¹„ë²•</a>
        </nav>
    </header>

    <main class="max-w-3xl mx-auto p-4">
        <div id="error-box" class="hidden mb-6 p-4 bg-red-50 border border-red-200 text-red-600 rounded-xl font-bold shadow-sm"></div>

        <section class="text-center mb-8 mt-2">
            <h1 class="text-3xl font-bold text-amber-900 mb-2">âœï¸ í€´ì¦ˆ ë²”ìœ„ ì„¤ì •</h1>
            <p class="text-amber-700 text-sm">ì›í•˜ëŠ” ì¡°ê±´ì„ ì„ íƒí•˜ì—¬ ë¬¸ì œë¥¼ ìƒì„±í•˜ì„¸ìš”.</p>
        </section>

        <section class="mb-6 bg-white p-6 rounded-2xl shadow-sm border border-amber-100">
            <h2 class="text-lg font-bold text-amber-800 mb-4 flex items-center">
                <span class="bg-amber-100 text-amber-600 w-6 h-6 rounded-full inline-flex items-center justify-center mr-2 text-sm">1</span>
                í€´ì¦ˆ ìœ í˜•
            </h2>
            <div class="flex flex-wrap gap-3">
                <label class="cursor-pointer relative flex-1 min-w-[120px]">
                    <input type="radio" name="quizType" value="word" checked class="peer sr-only">
                    <div class="px-4 py-3 rounded-xl border-2 border-amber-200 text-amber-800 bg-white hover:bg-amber-50 peer-checked:bg-amber-500 peer-checked:text-white peer-checked:border-amber-600 transition shadow-sm text-center font-bold h-full flex items-center justify-center">
                        ë‚±ë§ í€´ì¦ˆ
                    </div>
                </label>
                <label class="cursor-pointer relative flex-1 min-w-[120px]">
                    <input type="radio" name="quizType" value="sentence" class="peer sr-only">
                    <div class="px-4 py-3 rounded-xl border-2 border-amber-200 text-amber-800 bg-white hover:bg-amber-50 peer-checked:bg-amber-500 peer-checked:text-white peer-checked:border-amber-600 transition shadow-sm text-center font-bold h-full flex items-center justify-center">
                        ë¬¸ì¥ í€´ì¦ˆ
                    </div>
                </label>
            </div>
        </section>

        <section class="mb-6 bg-white p-6 rounded-2xl shadow-sm border border-amber-100">
            <h2 class="text-lg font-bold text-amber-800 mb-4 flex items-center">
                <span class="bg-amber-100 text-amber-600 w-6 h-6 rounded-full inline-flex items-center justify-center mr-2 text-sm">2</span>
                í•™ë…„ / í•™ê¸°
            </h2>
            <div id="grade-options" class="flex flex-wrap gap-2">
                <div class="text-gray-400 text-sm p-2">ë¡œë”© ì¤‘...</div>
            </div>
        </section>

        <section id="unit-section" class="mb-6 bg-white p-6 rounded-2xl shadow-sm border border-amber-100 transition-opacity duration-300 opacity-50 pointer-events-none grayscale">
            <h2 class="text-lg font-bold text-amber-800 mb-4 flex items-center">
                <span class="bg-amber-100 text-amber-600 w-6 h-6 rounded-full inline-flex items-center justify-center mr-2 text-sm">3</span>
                ë‹¨ì› ì„ íƒ
            </h2>
            <div id="unit-options" class="flex flex-wrap gap-2 max-h-60 overflow-y-auto pr-1">
                <div class="px-4 py-2 rounded-xl border-2 border-gray-100 text-gray-400 bg-gray-50 text-sm font-medium">
                    ì „ì²´ ë‹¨ì›
                </div>
            </div>
        </section>

        <section class="mb-6 bg-white p-6 rounded-2xl shadow-sm border border-amber-100">
            <h2 class="text-lg font-bold text-amber-800 mb-4 flex items-center">
                <span class="bg-amber-100 text-amber-600 w-6 h-6 rounded-full inline-flex items-center justify-center mr-2 text-sm">4</span>
                ê·œì¹™ ì„ íƒ <span class="text-xs font-normal text-gray-500 ml-2">(ì„ íƒ ì‚¬í•­)</span>
            </h2>
            <div id="rule-options" class="flex flex-wrap gap-2 max-h-60 overflow-y-auto pr-1">
                </div>
        </section>

        <section class="mb-8 bg-white p-6 rounded-2xl shadow-sm border border-amber-100">
            <h2 class="text-lg font-bold text-amber-800 mb-4 flex items-center">
                <span class="bg-amber-100 text-amber-600 w-6 h-6 rounded-full inline-flex items-center justify-center mr-2 text-sm">5</span>
                ë¬¸ì œ ê°œìˆ˜
            </h2>
            <div class="flex flex-wrap gap-3 items-center">
                <label class="cursor-pointer relative">
                    <input type="radio" name="qCountType" value="5" checked class="peer sr-only">
                    <div class="px-5 py-2 rounded-xl border-2 border-amber-200 text-amber-800 bg-white hover:bg-amber-50 peer-checked:bg-amber-500 peer-checked:text-white peer-checked:border-amber-600 transition shadow-sm font-medium">
                        5ê°œ
                    </div>
                </label>
                <label class="cursor-pointer relative">
                    <input type="radio" name="qCountType" value="10" class="peer sr-only">
                    <div class="px-5 py-2 rounded-xl border-2 border-amber-200 text-amber-800 bg-white hover:bg-amber-50 peer-checked:bg-amber-500 peer-checked:text-white peer-checked:border-amber-600 transition shadow-sm font-medium">
                        10ê°œ
                    </div>
                </label>
                <label class="cursor-pointer relative flex items-center gap-2">
                    <input type="radio" name="qCountType" value="custom" class="peer sr-only">
                    <div class="px-5 py-2 rounded-xl border-2 border-amber-200 text-amber-800 bg-white hover:bg-amber-50 peer-checked:bg-amber-500 peer-checked:text-white peer-checked:border-amber-600 transition shadow-sm font-medium">
                        ì§ì ‘ ì…ë ¥
                    </div>
                </label>
                <input type="number" id="custom-count-input" class="w-20 p-2 text-center border-2 border-amber-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-400 font-bold text-amber-900 disabled:bg-gray-100 disabled:text-gray-400 disabled:border-gray-200 transition" min="1" max="50" value="20" disabled>
            </div>
        </section>

        <button id="start-btn" class="w-full py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white text-xl font-bold rounded-2xl shadow-lg hover:from-amber-600 hover:to-orange-600 transform active:scale-[0.98] transition duration-200 flex items-center justify-center gap-2">
            <span>ğŸš€</span> í€´ì¦ˆ ì‹œì‘í•˜ê¸°
        </button>
        <div class="h-10"></div>
    </main>

    <script src="database.js"></script>

    <script>
        // --- 1. ì•ˆì „ ì¥ì¹˜: ë°ì´í„° ë¡œë“œ í™•ì¸ ---
        const errorBox = document.getElementById('error-box');

        function showError(msg) {
            errorBox.classList.remove('hidden');
            errorBox.innerHTML = `âš ï¸ ì˜¤ë¥˜ ë°œìƒ: ${msg}`;
            console.error(msg);
        }

        window.addEventListener('DOMContentLoaded', () => {
            // database.js ì—°ê²° í™•ì¸
            if (typeof quizData === 'undefined') {
                showError("ë°ì´í„° íŒŒì¼(database.js)ì´ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>database.js íŒŒì¼ì´ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
                return;
            }
            initApp();
        });

        // --- 2. ì•± ì´ˆê¸°í™” ë¡œì§ ---
        function initApp() {
            const gradeContainer = document.getElementById('grade-options');
            const unitContainer = document.getElementById('unit-options');
            const ruleContainer = document.getElementById('rule-options');
            const unitSection = document.getElementById('unit-section');

            // ë¬¸ì œ ê°œìˆ˜ ê´€ë ¨ ìš”ì†Œ
            const countRadios = document.querySelectorAll('input[name="qCountType"]');
            const customInput = document.getElementById('custom-count-input');

            // --- ë°ì´í„° ì¶”ì¶œ ë° ì •ì œ ---
            const grades = new Set();
            const rules = new Set();

            quizData.forEach(item => {
                // 1) í•™ë…„ ìˆ˜ì§‘
                if (item["Year/Semester"]) {
                    grades.add(item["Year/Semester"].trim());
                }

                // 2) ê·œì¹™ ìˆ˜ì§‘
                for (let i = 1; i <= 5; i++) {
                    let ruleVal = item[`Syllable ${i} Rule`] || item[`Syllable ${i} rule`];

                    if (ruleVal && typeof ruleVal === 'string' && ruleVal.trim() !== "") {
                        let val = ruleVal.trim();
                        // ì¤‘ë³µ ì‚­ì œ: ë²ˆí˜¸ê°€ ì—†ëŠ” 'ëª¨ìŒ í•©ì²´!' ë°ì´í„° ê±´ë„ˆëœ€
                        if (val === "ëª¨ìŒ í•©ì²´! (ëª¨ìŒ ì¶•ì•½Â·íƒˆë½)") {
                            continue;
                        }
                        rules.add(val);
                    }
                }
            });

            const sortedGrades = [...grades].sort();
            
            // ìˆ«ì ì¸ì‹ ì •ë ¬ (1, 2, ... 10)
            const sortedRules = [...rules].sort((a, b) => 
                a.localeCompare(b, undefined, { numeric: true, sensitivity: 'base' })
            );

            // --- ë Œë”ë§ í•¨ìˆ˜ (Tailwind ì ìš©) ---
            function renderRadioButtons(container, name, list, includeAll = true, allText = "ì „ì²´") {
                container.innerHTML = ''; // ì´ˆê¸°í™”

                if (includeAll) {
                    const allHtml = `
                        <label class="cursor-pointer relative">
                            <input type="radio" name="${name}" value="all" checked class="peer sr-only">
                            <div class="px-4 py-2 rounded-xl border-2 border-dashed border-amber-300 text-amber-700 bg-white hover:bg-amber-50 peer-checked:bg-amber-500 peer-checked:text-white peer-checked:border-amber-600 peer-checked:border-solid transition shadow-sm text-sm font-bold">
                                ${allText}
                            </div>
                        </label>
                    `;
                    container.insertAdjacentHTML('beforeend', allHtml);
                }

                list.forEach(val => {
                    const html = `
                        <label class="cursor-pointer relative">
                            <input type="radio" name="${name}" value="${val}" class="peer sr-only">
                            <div class="px-4 py-2 rounded-xl border-2 border-amber-100 text-gray-600 bg-white hover:bg-amber-50 peer-checked:bg-amber-500 peer-checked:text-white peer-checked:border-amber-600 transition shadow-sm text-sm font-medium">
                                ${val}
                            </div>
                        </label>
                    `;
                    container.insertAdjacentHTML('beforeend', html);
                });
            }

            // ì´ˆê¸° ë Œë”ë§ (í•™ë…„, ê·œì¹™)
            renderRadioButtons(gradeContainer, 'grade', sortedGrades, true, "ì „ì²´ í•™ë…„");
            renderRadioButtons(ruleContainer, 'rule', sortedRules, true, "ì „ì²´ ê·œì¹™");

            // --- ì´ë²¤íŠ¸: í•™ë…„ ì„ íƒ ì‹œ ë‹¨ì› ëª©ë¡ ì—…ë°ì´íŠ¸ ---
            gradeContainer.addEventListener('change', (e) => {
                if (e.target.name !== 'grade') return;

                const selectedGrade = e.target.value;

                if (selectedGrade === 'all') {
                    unitSection.classList.add('opacity-50', 'pointer-events-none', 'grayscale');
                    renderRadioButtons(unitContainer, 'unit', [], true, "ì „ì²´ ë‹¨ì›");
                } else {
                    unitSection.classList.remove('opacity-50', 'pointer-events-none', 'grayscale');

                    // í•´ë‹¹ í•™ë…„ì˜ ë‹¨ì›ë§Œ ì¶”ì¶œ (ì¤‘ë³µ ì œê±°)
                    const units = new Set();
                    quizData.forEach(item => {
                        if (item["Year/Semester"] && item["Year/Semester"].trim() === selectedGrade && item["Chapter"]) {
                            units.add(item["Chapter"].trim());
                        }
                    });

                    // ë‹¨ì›ëª… ì •ë ¬
                    const sortedUnits = [...units].sort((a, b) => 
                        a.localeCompare(b, undefined, { numeric: true, sensitivity: 'base' })
                    );
                    renderRadioButtons(unitContainer, 'unit', sortedUnits, true, "ì „ì²´ ë‹¨ì›");
                }
            });

            // --- ì´ë²¤íŠ¸: ë¬¸ì œ ê°œìˆ˜ (ì§ì ‘ ì…ë ¥ í™œì„±í™”/ë¹„í™œì„±í™”) ---
            countRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    if (e.target.value === 'custom') {
                        customInput.disabled = false;
                        customInput.focus();
                        // ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
                        customInput.classList.remove('bg-gray-100', 'text-gray-400', 'border-gray-200');
                        customInput.classList.add('border-amber-200', 'text-amber-900');
                    } else {
                        customInput.disabled = true;
                        // ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
                        customInput.classList.add('bg-gray-100', 'text-gray-400', 'border-gray-200');
                        customInput.classList.remove('border-amber-200', 'text-amber-900');
                    }
                });
            });

            // --- ì´ë²¤íŠ¸: ì‹œì‘ ë²„íŠ¼ ---
            document.getElementById('start-btn').addEventListener('click', () => {
                const type = document.querySelector('input[name="quizType"]:checked')?.value || 'word';
                const grade = document.querySelector('input[name="grade"]:checked')?.value || 'all';
                const unit = document.querySelector('input[name="unit"]:checked')?.value || 'all';
                const rule = document.querySelector('input[name="rule"]:checked')?.value || 'all';

                let countVal = document.querySelector('input[name="qCountType"]:checked').value;
                if (countVal === 'custom') {
                    countVal = customInput.value;
                    if (!countVal || countVal < 1) countVal = 10;
                }

                // URL íŒŒë¼ë¯¸í„° ì „ë‹¬
                const params = new URLSearchParams({
                    type, grade, unit, rule, count: countVal
                });

                window.location.href = `play.html?${params.toString()}`;
            });
        }
    </script>
</body>
</html>